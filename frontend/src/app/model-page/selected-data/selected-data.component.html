<mozaik-collapsible
  class="node"
  *ngFor="let node of nodeData; trackBy: trackById"
>
  <h1
    slot="header"
    class="node-anchor"
    [class.hovered]="(hoveredNode$ | async)?.id === node.node.id"
    (mouseenter)="hoverNode(node.node)"
    (mouseleave)="hoverNode(null)"
    (click)="$event.shiftKey ? handleSelect($event, node.node) : null"
  >
    Neuron #{{ node.node.id }}
  </h1>
  <mozaik-collapsible class="positions">
    <h2 slot="header">Positions</h2>
    <table>
      <tbody>
        <tr *ngFor="let sheet of node.node.sheets | keyvalue">
          <td>{{ sheet.key }}</td>
          <td>
            [{{ sheet.value.x | number : "1.0-4" }},
            {{ sheet.value.y | number : "1.0-4" }}]
          </td>
        </tr>
      </tbody>
    </table>
  </mozaik-collapsible>
  <mozaik-collapsible class="outgoing">
    <h2 slot="header">Outgoing ({{ node.node.sheets | sumsheets }})</h2>
    <ng-container *ngFor="let sheet of node.node.sheets | keyvalue">
      <mozaik-collapsible class="sheet" *ngIf="sheet.value.connections.length">
        <h3 slot="header">
          {{ sheet.key }} ({{ sheet.value.connections.length }})
        </h3>
        <table>
          <thead>
            <tr>
              <th>To</th>
              <th>Weight</th>
              <th>Delay</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tgt of sheet.value.connections">
              <td>
                <span
                  class="node-anchor"
                  [class.hovered]="(hoveredNode$ | async)?.id === tgt.node"
                  (mouseenter)="hoverNode(tgt.node)"
                  (mouseleave)="hoverNode(null)"
                  (click)="handleSelect($event, tgt.node)"
                  >#{{ tgt.node }}</span
                >
              </td>
              <td>{{ tgt.weight | number : "1.0-4" }}</td>
              <td>{{ tgt.delay | number : "1.0-4" }}</td>
            </tr>
          </tbody>
        </table>
      </mozaik-collapsible>
    </ng-container>
  </mozaik-collapsible>
  <mozaik-collapsible class="incoming">
    <h2 slot="header">Incoming ({{ node.in | sumsheets }})</h2>
    <ng-container *ngFor="let sheet of node.in | keyvalue">
      <mozaik-collapsible class="sheet" *ngIf="sheet.value.length">
        <h3 slot="header">{{ sheet.key }} ({{ sheet.value.length }})</h3>
        <table>
          <thead>
            <tr>
              <th>From</th>
              <th>Weight</th>
              <th>Delay</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tgt of sheet.value">
              <td>
                <span
                  class="node-anchor"
                  [class.hovered]="(hoveredNode$ | async)?.id === tgt.from"
                  (mouseenter)="hoverNode(tgt.from)"
                  (mouseleave)="hoverNode(null)"
                  (click)="handleSelect($event, tgt.from)"
                  >#{{ tgt.from }}</span
                >
              </td>
              <td>{{ tgt.weight | number : "1.0-4" }}</td>
              <td>{{ tgt.delay | number : "1.0-4" }}</td>
            </tr>
          </tbody>
        </table>
      </mozaik-collapsible>
    </ng-container>
  </mozaik-collapsible>
</mozaik-collapsible>
